<!DOCTYPE html>
<html>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <head>
        <style>
            body {
                font-family: system-ui;
                font-size: 16px;
            }

            .toucharea {
                margin: 1em auto;
                border: 0.5em solid black;
                width: 200px;
                height: 200px;
                box-sizing: border-box;
                border-radius: 0.5em;
                padding: 1em;
                -webkit-text-size-adjust: none;
                outline: none;
                line-height: 1.25;
            }

            section {
                border-top: 1px solid black;
                margin: 1em auto;
            }

            p, h1 {
                text-align: center;
                max-width: 320px;
                margin: 1em auto;
            }

            h1 {
                margin: 0.5em auto;
            }

            .scrolls {
                overflow: scroll;
            }

            a {
                text-decoration: none;
                color: rgb(0, 122, 255);
            }

            a.toggle {
                margin: 0 auto;
                text-align: center;
                max-width: 320px;
                display: block;
            }

            .blue-transparent { background-color: rgba(0, 122, 255, 0.25); }
            .blue { background-color: rgb(0, 122, 255); }
            .green-transparent { background-color: rgba(52, 199, 89, 0.25); }
            .green { background-color: rgb(52, 199, 89); }
            .indigo-transparent { background-color: rgba(88, 86, 214, 0.25); }
            .indigo { background-color: rgb(88, 86, 214); }
            .orange-transparent { background-color: rgba(255, 149, 0, 0.25); }
            .orange { background-color: rgb(255, 149, 0); }
            .pink-transparent { background-color: rgba(255, 45, 85, 0.25); }
            .pink { background-color: rgb(255, 45, 85); }
            .purple-transparent { background-color: rgba(175, 82, 222, 0.25); }
            .purple { background-color: rgb(175, 82, 222); }
            .red-transparent { background-color: rgba(255, 59, 48, 0.25); }
            .red { background-color: rgb(255, 59, 48); }
            .teal-transparent { background-color: rgba(90, 200, 250, 0.25); }
            .teal { background-color: rgb(90, 200, 250); }
            .yellow-transparent { background-color: rgba(255, 204, 0, 0.25); }
            .yellow { background-color: rgb(255, 204, 0); }

            .flash {
                position: fixed;
                bottom: 10px;
                left: 10px;
                font-size: 20px;
                transition: 1.5s cubic-bezier(0.5, 0, 0, 0);
            }

            .flash-begin {
                transform: translateY(-200px);
                opacity: 0;
            }
        </style>
    </head>
    <body>
        <section id="passive-section">
            <h1>Passive</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="teal-transparent toucharea passive"></div>
                <p>Passive touchstart listener</p>
                <div class="teal-transparent toucharea passive" contenteditable><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Passive touchstart listener; Editable text</p>
                <div class="teal-transparent toucharea scrolls passive"><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Passive touchstart listener; Scrollable</p>
            </div>
        </section>
        <section id="passive-with-active-touchmove-section">
            <h1>Passive touchstart, active touchmove</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="pink-transparent toucharea scrolls passive no-prevent-touchmove"><button style="display: block;">Try clicking me?</button> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Passive touchstart listener; no preventDefault() on touchmove; scrollable</p>
                <div class="pink-transparent toucharea scrolls passive no-prevent-touchmove-medium"><button style="display: block;">Try clicking me?</button> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Passive touchstart listener; no preventDefault() on touchmove; 30ms delay; scrollable</p>
                <div class="pink-transparent toucharea scrolls passive prevent-touchmove"><button style="display: block;">Try clicking me?</button> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Passive touchstart listener; preventDefault() on touchmove; scrollable</p>
                <div class="pink-transparent toucharea scrolls passive prevent-touchmove-medium"><button style="display: block;">Try clicking me?</button> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Passive touchstart listener; preventDefault() on touchmove; 30ms delay; scrollable</p>
            </div>
        </section>
        <section id="dynamic-handlers">
            <h1>Dynamically added listeners</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="yellow-transparent toucharea scrolls add-prevent-touch-move"><button style="display: block;">Try clicking me?</button> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>On touchstart, add touchmove listener that prevents default</p>
            </div>
        </section>
        <section id="no-prevent-default-fast-section">
            <h1>no preventDefault (immediate)</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="blue-transparent toucharea no-prevent-default-fast"></div>
                <p>Not passive; no preventDefault() on touchstart</p>
                <div class="blue-transparent toucharea no-prevent-default-fast" contenteditable><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; no preventDefault() on touchstart; editable text</p>
                <div class="blue-transparent toucharea scrolls no-prevent-default-fast"><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; no preventDefault() on touchstart; scrollable</p>
            </div>
        </section>
        <section id="no-prevent-default-medium-section">
            <h1>no preventDefault (400 ms)</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="green-transparent toucharea no-prevent-default-medium"></div>
                <p>Not passive; no preventDefault() on touchstart; 400ms delay</p>
                <div class="green-transparent toucharea no-prevent-default-medium" contenteditable><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; no preventDefault() on touchstart; 400ms delay; editable text</p>
                <div class="green-transparent toucharea scrolls no-prevent-default-medium"><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; no preventDefault() on touchstart; 400ms delay; scrollable</p>
            </div>
        </section>
        <section id="no-prevent-default-slow-section">
            <h1>no preventDefault (1200 ms)</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="red-transparent toucharea no-prevent-default-slow"></div>
                <p>Not passive; no preventDefault() on touchstart; 1200ms delay</p>
                <div class="red-transparent toucharea no-prevent-default-slow" contenteditable><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; no preventDefault() on touchstart; 1200ms delay; editable text</p>
                <div class="red-transparent toucharea scrolls no-prevent-default-slow"><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; no preventDefault() on touchstart; 1200ms delay; scrollable</p>
            </div>
        </section>
        <section id="prevent-default-fast-section">
            <h1>preventDefault (immediate)</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="indigo-transparent toucharea prevent-default-fast"></div>
                <p>Not passive; preventDefault() on touchstart</p>
                <div class="indigo-transparent toucharea prevent-default-fast" contenteditable><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; preventDefault() on touchstart; editable text</p>
                <div class="indigo-transparent toucharea scrolls prevent-default-fast"><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; preventDefault() on touchstart; scrollable</p>
            </div>
        </section>
        <section id="prevent-default-medium-section">
            <h1>preventDefault (400 ms)</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="purple-transparent toucharea prevent-default-medium"></div>
                <p>Not passive; preventDefault() on touchstart; 400ms delay</p>
                <div class="purple-transparent toucharea prevent-default-medium" contenteditable><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; preventDefault() on touchstart; 400ms delay; editable text</p>
                <div class="purple-transparent toucharea scrolls prevent-default-medium"><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; preventDefault() on touchstart; 400ms delay; scrollable</p>
            </div>
        </section>
        <section id="prevent-default-slow-section">
            <h1>preventDefault (1200 ms)</h1>
            <a class="toggle" href="#">[-] Collapse</a>
            <div class="touchareas">
                <div class="orange-transparent toucharea prevent-default-slow"></div>
                <p>Not passive; preventDefault() on touchstart; 1200ms delay</p>
                <div class="orange-transparent toucharea prevent-default-slow" contenteditable><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; preventDefault() on touchstart; 1200ms delay; editable text</p>
                <div class="orange-transparent toucharea scrolls prevent-default-slow"><a href="https://www.webkit.org">Link to webkit.org</a> The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog. The quick brown fox jumped over the lazy dog.</div>
                <p>Not passive; preventDefault() on touchstart; 1200ms delay; scrollable</p>
            </div>
        </section>

        <script>
            document.querySelectorAll(".toucharea").forEach(element => {
                element.addEventListener("touchstart", event => flash("start", "green", "bold"), { passive : true });
                element.addEventListener("touchmove", event => flash("move", "rgb(255, 204, 0)", "100"), { passive : true });
                element.addEventListener("touchend", event => flash("end", "red", "bold"), { passive : true });
                element.addEventListener("touchcancel", event => flash("cancel", "purple", "bold"), { passive : true });
            });

            document.querySelectorAll(".passive").forEach(element => {
                element.addEventListener("touchstart", event => {
                    console.log(event);
                }, { passive : true });
            });

            document.querySelectorAll(".prevent-touchmove").forEach(element => {
                element.addEventListener("touchmove", event => {
                    console.log(event);
                    event.preventDefault();
                }, { passive: false });
            });

            document.querySelectorAll(".no-prevent-touchmove").forEach(element => {
                element.addEventListener("touchmove", event => {
                    console.log(event);
                }, { passive: false });
            });

            document.querySelectorAll(".prevent-touchmove-medium").forEach(element => {
                element.addEventListener("touchmove", event => {
                    console.log(event);
                    const startTime = Date.now();
                    while (1) {
                        if (Date.now() - startTime > 30)
                            break;
                    }
                    event.preventDefault();
                }, { passive: false });
            });

            document.querySelectorAll(".no-prevent-touchmove-medium").forEach(element => {
                element.addEventListener("touchmove", event => {
                    console.log(event);
                    const startTime = Date.now();
                    while (1) {
                        if (Date.now() - startTime > 30)
                            break;
                    }
                }, { passive: false });
            });

            document.querySelectorAll(".add-prevent-touch-move").forEach(element => {
                const handleMove = function(event) {
                    console.log(event);
                    event.preventDefault();
                };

                element.addEventListener("touchstart", () => {
                    console.log(event);
                    element.addEventListener("touchmove", handleMove, { passive: false });
                }, { passive: false });

                element.addEventListener("touchend", () => {
                    console.log(event);
                    element.removeEventListener("touchmove", handleMove);
                });
            });

            document.querySelectorAll(".prevent-default-fast").forEach(element => {
                element.addEventListener("touchstart", event => {
                    console.log(event);
                    event.preventDefault();
                });
            });

            document.querySelectorAll(".prevent-default-medium").forEach(element => {
                element.addEventListener("touchstart", event => {
                    console.log(event);
                    const startTime = Date.now();
                    while (1) {
                        if (Date.now() - startTime > 400)
                            break;
                    }
                    event.preventDefault();
                });
            });

            document.querySelectorAll(".prevent-default-slow").forEach(element => {
                element.addEventListener("touchstart", event => {
                    console.log(event);
                    const startTime = Date.now();
                    while (1) {
                        if (Date.now() - startTime > 1200)
                            break;
                    }
                    event.preventDefault();
                });
            });

            document.querySelectorAll(".no-prevent-default-fast").forEach(element => {
                element.addEventListener("touchstart", event => {
                    console.log(event);
                });
            });

            document.querySelectorAll(".no-prevent-default-medium").forEach(element => {
                element.addEventListener("touchstart", event => {
                    console.log(event);
                    const startTime = Date.now();
                    while (1) {
                        if (Date.now() - startTime > 400)
                            break;
                    }
                });
            });

            document.querySelectorAll(".no-prevent-default-slow").forEach(element => {
                element.addEventListener("touchstart", event => {
                    console.log(event);
                    const startTime = Date.now();
                    while (1) {
                        if (Date.now() - startTime > 1200)
                            break;
                    }
                });
            });

            function toggleSectionVisibility(section) {
                const touchareas = section.querySelector(".touchareas");
                touchareas.display = touchareas.style.display = touchareas.style.display === "none" ? "block" : "none";
                section.querySelector("a.toggle").textContent = touchareas.style.display === "none" ? "[+] Expand" : "[-] Collapse";
                saveCollapsedSectionIDs();
            }

            document.querySelectorAll("a.toggle").forEach(anchor => {
                anchor.addEventListener("click", event => {
                    toggleSectionVisibility(anchor.parentElement);
                    event.preventDefault();
                });
            });

            function collapsedSectionIDsFromLocalStorage() {
                const data = localStorage.getItem("collapsed-section-ids");
                return data ? JSON.parse(data) : [];
            }

            function saveCollapsedSectionIDs() {
                const IDs = [];
                document.querySelectorAll("section").forEach(section => {
                    if (section.querySelector(".touchareas").display === "none")
                        IDs.push(section.id);
                });
                localStorage.setItem("collapsed-section-ids", JSON.stringify(IDs));
            }

            for (const id of collapsedSectionIDsFromLocalStorage()) {
                const section = document.getElementById(id);
                if (section)
                    toggleSectionVisibility(section);
            }

            function flash(message, color, fontWeight) {
                let div = document.createElement("div");
                let code = document.createElement("code");
                code.textContent = message;
                div.appendChild(code);
                if (color)
                    div.style.color = color;
                if (fontWeight)
                    div.style.fontWeight = fontWeight;
                div.classList.add("flash");
                div.addEventListener("transitionend", () => div.remove());
                setTimeout(() => div.classList.add("flash-begin"), 50);
                document.body.appendChild(div);
            }
        </script>
    </body>
</html>